<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Vivek Selvaraj"/><link rel="canonical" href="https://vivek.dev/posts/2021-01-25-Linux-killing-descendant-prcosses"/><meta name="twitter:url" content="https://vivek.dev/posts/2021-01-25-Linux-killing-descendant-prcosses"/><meta name="og:url" content="https://vivek.dev/posts/2021-01-25-Linux-killing-descendant-prcosses"/><title>Killing all descendant processes in Linux | Vivek Selvaraj</title><meta name="twitter:title" content="Killing all descendant processes in Linux | Vivek Selvaraj"/><meta name="og:title" content="Killing all descendant processes in Linux | Vivek Selvaraj"/><meta name="description" content="How to kill a process and its entire process subtree with a shell script"/><meta name="twitter:description" content="How to kill a process and its entire process subtree with a shell script"/><meta name="og:description" content="How to kill a process and its entire process subtree with a shell script"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Vivek Selvaraj"/></head><body class="item-page"><div class="wrapper"><article><h1>Killing all descendant processes in Linux</h1><p>by <a href="/">Vivek Selvaraj</a></p><div class="content"><h2><code>kill</code> command</h2><p>At my daily job, I had to force stop a process with its process ID. No big deal right? Just run the kill command as <code> kill -9 &lt;pid&gt;</code> to stop it abruptly. This works, if that is the only process that I had to kill. The process can have some subprocesses which are started by it. Those subprocesses can have more subprocesses under it (this can go on forever). The kill command can do the job only if I know the process IDs of all the processes that I want to kill.</p><h2><code>pkill</code> command</h2><p>With some preliminary google search, <code>pkill</code> looked promising. It can kill the child processes of a target process with the -P option <code>pkill -P &lt;ppid&gt;</code> (Where ppid is the parent process ID). Even this does not cater to the recursive killing of subprocesses that I am looking for.</p><h2><code>killThemAll.sh</code></h2><p>Since no built in commands in Linux had the ability to recursively kill the subprocesses of a parent process, I decided to write a shell script of my own. You might think that I could have killed by the process' group ID. In my particular case, the target process itself was spawned by another process. This made the target process and all its subprocesses to take up the parent's process ID as their group ID</p><pre><code><div class="highlight"><span></span><span class="ch">#!/bin/sh</span>

<span class="c1"># Check if arguments are present</span>
<span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Error: Please enter a Process ID to kill&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Check if the argument is an integer</span>
<span class="nv">REGEX</span><span class="o">=</span><span class="s1">&#39;^[0-9]+$&#39;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">=</span>~ <span class="nv">$REGEX</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Error: Process ID is not a number&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
  <span class="nb">echo</span> <span class="s2">&quot;Please enter an integer for Process ID&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Prints the child processes of a process with</span>
<span class="c1"># pgrep command - Recursively</span>
findChildProcesses<span class="o">()</span>
<span class="o">{</span>
  <span class="nv">CHILDREN</span><span class="o">=</span><span class="k">$(</span>pgrep -P <span class="nv">$1</span><span class="k">)</span>
  <span class="k">if</span> <span class="o">[[</span> -n <span class="s2">&quot;</span><span class="nv">$CHILDREN</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="nv">$CHILDREN</span>
  <span class="k">fi</span>
  <span class="k">for</span> PID <span class="k">in</span> <span class="nv">$CHILDREN</span>
  <span class="k">do</span>
    findChildProcesses <span class="nv">$PID</span>
  <span class="k">done</span>
<span class="o">}</span>

<span class="c1"># Command to kill all the processes listed by the above function</span>
<span class="nb">kill</span> -9 <span class="nv">$1</span> <span class="sb">`</span>findChildProcesses <span class="nv">$1</span><span class="sb">`</span>
</div></code></pre><p>I sought the help of the <code>pgrep</code> command to find the child processes under a process.</p></div></article></div><footer><p>Handcrafted in Coimbatore with <a href="https://github.com/johnsundell/publish">Publish</a><br/><a href="/feed.rss">RSS feed</a></p></footer></body></html>